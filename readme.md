# 語句の出現頻度を調べよう

文章に出現する頻出語句がわかれば、その文章の特徴を浮彫にすることができます。
ここでは、形態素解析を利用するもう一つの例として、語句の出現頻度を調べるプログラムを作成します。

## 語句の出現頻度を調べる

形態素解析さえ行ってしまえば頻出語句を調べるのはそれほど難しい問題ではありません。
JavaScript Object 型を利用すれば、手軽に単語出現回数を数える事ができます。

簡単なプログラムを書いて、その実行方法を確認していきましょう。 `hindo.js` と言う名前のファイルを作成して以下の様に記述してみます。
```javascript
// 単語の出現頻度を調べる
var Mecab = require('./mecab-mod.js');
var mecab = new Mecab();
var fs = require('fs');

// 引数をチェック
var args = process.argv;
args.shift(); // 除去 'node'
args.shift(); // 除去 スクリプトのパス
if (args.length <= 0) {
	console.log('node hindo.js textfile');
	process.exit();
}
var filename = args.shift();

// ファイルを読み込む
var text = fs.readFileSync(filename, "utf-8");
// 形態素解析を行う
mecab.parse(text, function (err, items) {
	checkHindo(items);
});

// 出現頻度を調べる
function checkHindo(items) {
	// 語句をオブジェクトに格納し頻度を調べる
	var words = {};
	for (var i in items) {
		var it = items[i];
		var w = it[0];
		if (words[w] == undefined) {
			words[w] = 1;
		} else {
			words[w]++;
		}
	}
	// 語句を出現頻度にソートするため配列にコピー
	var list = [];
	for (var key in words) {
		list.push({
			"word": key,
			"nums": words[key]
		});
	}
	// ソートする
	list.sort(function (a, b) {
		return b.nums - a.nums;
	});
	// 画面に出力する
	for (var i = 0; i < list.length; i++) {
		var it = list[i];
		console.log((i + 1) + ":" + it.word + "(" + it.nums + ")");
	}
}
```
上記のプログラムで使用するモジュール`mecab-mod.js`と動作に必要な環境については下記のMeCabについてを参照してください。

[MeCabについて<br>https://github.com/shigetaa/nodejs52mecab](https://github.com/shigetaa/nodejs52mecab)

本ブログラムで使用する、文章データ`text.txt`は下記の様に記述します。
```txt
私はその人を常に先生と呼んでいた。だからここでもただ先生と書くだけで本名は打ち明けない。これは世間を憚かる遠慮というよりも、その方が私にとって自然だからである。私はその人の記憶を呼び起すごとに、すぐ「先生」といいたくなる。筆を執っても心持は同じ事である。よそよそしい頭文字などはとても使う気にならない。
私が先生と知り合いになったのは鎌倉である。その時私はまだ若々しい書生であった。暑中休暇を利用して海水浴に行った友達からぜひ来いという端書を受け取ったので、私は多少の金を工面して、出掛ける事にした。私は金の工面に二、三日を費やした。ところが私が鎌倉に着いて三日と経たないうちに、私を呼び寄せた友達は、急に国元から帰れという電報を受け取った。電報には母が病気だからと断ってあったけれども友達はそれを信じなかった。友達はかねてから国元にいる親たちに勧まない結婚を強いられていた。彼は現代の習慣からいうと結婚するにはあまり年が若過ぎた。それに肝心の当人が気に入らなかった。それで夏休みに当然帰るべきところを、わざと避けて東京の近くで遊んでいたのである。彼は電報を私に見せてどうしようと相談をした。私にはどうしていいか分らなかった。けれども実際彼の母が病気であるとすれば彼は固より帰るべきはずであった。それで彼はとうとう帰る事になった。せっかく来た私は一人取り残された。
学校の授業が始まるにはまだ大分日数があるので鎌倉におってもよし、帰ってもよいという境遇にいた私は、当分元の宿に留まる覚悟をした。友達は中国のある資産家の息子で金に不自由のない男であったけれども、学校が学校なのと年が年なので、生活の程度は私とそう変りもしなかった。したがって一人ぼっちになった私は別に恰好な宿を探す面倒ももたなかったのである。
宿は鎌倉でも辺鄙な方角にあった。玉突きだのアイスクリームだのというハイカラなものには長い畷を一つ越さなければ手が届かなかった。車で行っても二十銭は取られた。けれども個人の別荘はそこここにいくつでも建てられていた。それに海へはごく近いので海水浴をやるには至極便利な地位を占めていた。
私は毎日海へはいりに出掛けた。古い燻ぶり返った藁葺の間を通り抜けて磯へ下りると、この辺にこれほどの都会人種が住んでいるかと思うほど、避暑に来た男や女で砂の上が動いていた。ある時は海の中が銭湯のように黒い頭でごちゃごちゃしている事もあった。その中に知った人を一人ももたない私も、こういう賑やかな景色の中に裹まれて、砂の上に寝そべってみたり、膝頭を波に打たしてそこいらを跳ね廻るのは愉快であった。
私は実に先生をこの雑沓の間に見付け出したのである。その時海岸には掛茶屋が二軒あった。私はふとした機会からその一軒の方に行き慣れていた。長谷辺に大きな別荘を構えている人と違って、各自に専有の着換場を拵えていないここいらの避暑客には、ぜひともこうした共同着換所といった風なものが必要なのであった。彼らはここで茶を飲み、ここで休息する外に、ここで海水着を洗濯させたり、ここで鹹はゆい身体を清めたり、ここへ帽子や傘を預けたりするのである。海水着を持たない私にも持物を盗まれる恐れはあったので、私は海へはいるたびにその茶屋へ一切を脱ぎ棄てる事にしていた。
```
実行するには、以下のコマンドを実行します。
```bash
node hindo.js text.txt
```
```bash
1:に(47)
2:た(45)
3:は(44)
4:。(39)
5:を(34)
6:の(34)
7:で(27)
8:て(25)
9:、(24)
10:私(21)
11:が(17)
...[省略]...
```
実行結果を見てみると、助詞、や句読点がたくさん抽出されているのが分かります。
そのため、意味のありそうな語句はそれほど上位に表示されません。

### 助詞や句読点を除外する
そこで、次に助詞や句読点を表示しない様にプログラムを少し改良した`hindo2.js`ファイルを作成してみます。

```javascript
// 単語の出現頻度を調べる
var Mecab = require('./mecab-mod.js');
var mecab = new Mecab();
var fs = require('fs');

// 引数を読む
if (process.argv.length < 3) {
	console.log("no file");
	process.exit();
}
var filename = process.argv[2];
// ファイルを読み込む
var text = fs.readFileSync(filename, "utf-8");
// 形態素解析を行う
mecab.parse(text, function (err, items) {
	checkHindo2(items);
});

// 出現頻度を調べる
function checkHindo2(items) {
	// 語句をオブジェクトに格納し頻度を調べる
	var words = {}; // --- (※2)
	for (var i in items) {
		var it = items[i];
		var w = it[0];
		var h = it[1];
		// 意味のない語句を除外する
		if (h != "名詞" && h != "動詞" && h != "形容詞") continue;
		if (words[w] == undefined) {
			words[w] = 1;
		} else {
			words[w]++;
		}
	}
	// 語句を出現頻度にソートするため配列にコピー
	var list = [];
	for (var key in words) {
		list.push({
			"word": key,
			"nums": words[key]
		});
	}
	// ソートする
	list.sort(function (a, b) {
		return b.nums - a.nums;
	});
	// 頻出上位の語句を画面に出力する
	for (var i = 0; i < 15; i++) {
		var it = list[i];
		console.log((i + 1) + ":" + it.word + "(" + it.nums + ")");
	}
}
```

実行するには、以下のコマンドを実行します。
```bash
node hindo2.js text.txt
```
```bash
1:私(21)
2:い(11)
3:の(9)
4:し(9)
5:ここ(7)
6:人(6)
7:先生(5)
8:事(5)
9:友達(5)
10:あっ(5)
11:いる(5)
12:彼(5)
13:鎌倉(4)
14:海(4)
15:着(4)
```
